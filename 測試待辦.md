# 測試待辦清單

## 專案測試架構規劃

### 測試類型分類
- **Unit Tests**: 單元測試（services, utils, models）
- **Component Tests**: 組件測試（Vue components）  
- **Integration Tests**: 整合測試（API endpoints）
- **E2E Tests**: 端到端測試（完整用戶流程）

---

## 一、後端測試 (Backend Tests)

### 1. 服務層測試 (Services)
`tests/unit/server/services/`

#### 1.1 庫存管理服務 ✅
- **檔案**: `inventory/stockManagement.test.js` ✅
- **測試內容**:
  - 獲取店鋪庫存清單
  - 獲取單個庫存項目
  - 根據菜品模板獲取庫存
  - 庫存篩選功能（類型、可用性）
  - 錯誤處理（找不到項目）

#### 1.2 庫存統計服務
- **檔案**: `inventory/stockStats.test.js`
- **測試內容**:
  - 庫存統計數據計算
  - 低庫存警告統計
  - 庫存變動趨勢分析
  - 庫存報表生成

#### 1.3 訂單服務（客戶端）
- **檔案**: `order/orderCustomer.test.js`
- **測試內容**:
  - 創建訂單流程
  - 訂單項目計算
  - 優惠券套用
  - 積分計算與扣除
  - 庫存扣減邏輯
  - 訂單狀態管理

#### 1.4 訂單服務（管理端）
- **檔案**: `order/orderAdmin.test.js`
- **測試內容**:
  - 訂單查詢與篩選
  - 訂單狀態更新
  - 退款處理
  - 訂單統計報表

#### 1.5 用戶認證服務
- **檔案**: `user/userAuthService.test.js`
- **測試內容**:
  - 用戶註冊流程
  - 登入驗證
  - 密碼重設
  - 驗證碼發送與驗證
  - JWT token 管理

#### 1.6 管理員認證服務
- **檔案**: `user/adminAuthService.test.js`
- **測試內容**:
  - 管理員登入
  - 權限驗證
  - 會話管理
  - 角色權限檢查

#### 1.7 菜品服務
- **檔案**: `dish/dishTemplate.test.js`
- **測試內容**:
  - 菜品模板CRUD操作
  - 菜品選項管理
  - 菜品分類管理
  - 菜品圖片處理

#### 1.8 促銷服務
- **檔案**: `promotion/couponService.test.js`
- **測試內容**:
  - 優惠券驗證邏輯
  - 優惠券套用計算
  - 使用次數限制
  - 有效期檢查

- **檔案**: `promotion/pointService.test.js`
- **測試內容**:
  - 積分規則計算
  - 積分累積與扣除
  - 積分兌換功能
  - 積分歷史記錄

#### 1.9 店鋪管理服務
- **檔案**: `store/storeManagement.test.js`
- **測試內容**:
  - 店鋪資訊管理
  - 營業時間設定
  - 店鋪狀態管理
  - 配送設定

#### 1.10 菜單服務
- **檔案**: `store/menuService.test.js`
- **測試內容**:
  - 菜單建立與更新
  - 菜單分類管理
  - 菜品與菜單關聯
  - 菜單發布狀態

### 2. 控制器測試 (Controllers)
`tests/unit/server/controllers/`

#### 2.1 訂單控制器
- **檔案**: `Order/orderCustomer.test.js`
- **測試內容**:
  - API 請求處理
  - 參數驗證
  - 響應格式
  - 錯誤處理

#### 2.2 用戶控制器
- **檔案**: `User/userAuth.test.js`
- **測試內容**:
  - 註冊/登入 API
  - 參數驗證
  - 響應格式
  - 會話管理

#### 2.3 庫存控制器
- **檔案**: `Store/inventory.test.js`
- **測試內容**:
  - 庫存查詢 API
  - 庫存調整 API
  - 權限檢查
  - 參數驗證

### 3. 中介軟體測試 (Middlewares)
`tests/unit/server/middlewares/`

#### 3.1 認證中介軟體
- **檔案**: `auth/authentication.test.js`
- **測試內容**:
  - JWT token 驗證
  - 會話檢查
  - 用戶狀態驗證
  - 錯誤處理

#### 3.2 授權中介軟體
- **檔案**: `auth/authorization.test.js`
- **測試內容**:
  - 角色權限檢查
  - 店鋪權限驗證
  - 功能權限檢查
  - 拒絕存取處理

#### 3.3 驗證中介軟體
- **檔案**: `validator.test.js`
- **測試內容**:
  - 輸入參數驗證
  - 資料格式檢查
  - 必填欄位驗證
  - 自定義驗證規則

### 4. 模型測試 (Models)
`tests/unit/server/models/`

#### 4.1 用戶模型
- **檔案**: `User/User.test.js`
- **測試內容**:
  - 資料驗證規則
  - 密碼加密
  - 虛擬屬性
  - 模型方法

#### 4.2 訂單模型
- **檔案**: `Order/Order.test.js`
- **測試內容**:
  - 訂單編號生成
  - 金額計算
  - 狀態轉換規則
  - 關聯資料

#### 4.3 庫存模型
- **檔案**: `Store/Inventory.test.js`
- **測試內容**:
  - 庫存數量驗證
  - 閾值檢查
  - 自動更新邏輯
  - 索引設定

### 5. 工具函數測試 (Utils)
`tests/unit/server/utils/`

#### 5.1 日期工具
- **檔案**: `date.test.js`
- **測試內容**:
  - 日期格式化
  - 時區轉換
  - 日期計算
  - 有效性檢查

---

## 二、前端測試 (Frontend Tests)

### 1. 狀態管理測試 (Stores)
`tests/unit/src/stores/`

#### 1.1 購物車狀態
- **檔案**: `cart.test.js`
- **測試內容**:
  - 商品新增/移除
  - 數量調整
  - 總金額計算
  - 優惠券套用
  - 清空購物車

#### 1.2 客戶認證狀態
- **檔案**: `customerAuth.test.js`
- **測試內容**:
  - 登入/登出狀態
  - 用戶資訊儲存
  - token 管理
  - 自動登入檢查

#### 1.3 菜單狀態
- **檔案**: `menu.test.js`
- **測試內容**:
  - 菜單資料載入
  - 分類篩選
  - 搜尋功能
  - 收藏功能

#### 1.4 櫃台系統狀態
- **檔案**: `counter/cart.test.js`
- **測試內容**:
  - POS 購物車管理
  - 訂單建立
  - 支付處理
  - 列印功能

### 2. API 模組測試 (API Modules)
`tests/unit/src/api/modules/`

#### 2.1 訂單 API
- **檔案**: `orderCustomer.test.js`
- **測試內容**:
  - API 請求格式
  - 響應處理
  - 錯誤處理
  - 重試機制

#### 2.2 認證 API
- **檔案**: `userAuth.test.js`
- **測試內容**:
  - 登入/註冊請求
  - token 處理
  - 錯誤訊息處理
  - 請求攔截器

#### 2.3 菜單 API
- **檔案**: `menu.test.js`
- **測試內容**:
  - 菜單資料請求
  - 快取機制
  - 離線處理
  - 資料更新

### 3. 組件測試 (Components)
`tests/unit/src/components/`

#### 3.1 客戶端組件
- **檔案**: `customer/cart/CartItem.test.vue`
- **測試內容**:
  - 商品資訊顯示
  - 數量調整按鈕
  - 刪除功能
  - 價格計算顯示

- **檔案**: `customer/menu/MenuItemCard.test.vue`
- **測試內容**:
  - 菜品資訊顯示
  - 新增到購物車
  - 選項選擇
  - 圖片載入

#### 3.2 管理端組件
- **檔案**: `BrandAdmin/Order/OrderList.test.vue`
- **測試內容**:
  - 訂單列表顯示
  - 篩選功能
  - 狀態更新
  - 分頁功能

- **檔案**: `BrandAdmin/Inventory/StockDetail.test.vue`
- **測試內容**:
  - 庫存資訊顯示
  - 庫存調整
  - 歷史記錄
  - 警告提示

#### 3.3 櫃台系統組件
- **檔案**: `counter/OrderCart/ShoppingCart.test.vue`
- **測試內容**:
  - POS 購物車顯示
  - 快速操作按鈕
  - 結帳流程
  - 支付選項

### 4. Composables 測試
`tests/unit/src/composables/`

#### 4.1 語言切換
- **檔案**: `useLanguage.test.js`
- **測試內容**:
  - 語言切換功能
  - 本地儲存
  - 預設語言設定
  - 翻譯更新

#### 4.2 權限檢查
- **檔案**: `usePermissions.test.js`
- **測試內容**:
  - 角色權限檢查
  - 動態權限更新
  - 權限快取
  - 無權限處理

---

## 三、整合測試 (Integration Tests)

### 1. API 整合測試
`tests/integration/api/`

#### 1.1 訂單流程整合
- **檔案**: `order/orderFlow.test.js`
- **測試內容**:
  - 完整下單流程
  - 庫存扣減驗證
  - 積分計算驗證
  - 訂單狀態更新

#### 1.2 認證流程整合
- **檔案**: `auth/authFlow.test.js`
- **測試內容**:
  - 註冊到登入完整流程
  - 會話管理
  - 權限檢查
  - token 更新

### 2. 資料庫整合測試
`tests/integration/database/`

#### 2.1 資料一致性測試
- **檔案**: `dataConsistency.test.js`
- **測試內容**:
  - 關聯資料完整性
  - 事務處理
  - 併發操作
  - 資料回滾

---

## 四、端到端測試 (E2E Tests)

### 1. 客戶端流程
`tests/e2e/customer/`

#### 1.1 下單流程
- **檔案**: `orderFlow.cy.js`
- **測試內容**:
  - 瀏覽菜單
  - 加入購物車
  - 結帳付款
  - 訂單確認

#### 1.2 會員功能
- **檔案**: `memberFeatures.cy.js`
- **測試內容**:
  - 註冊登入
  - 積分使用
  - 優惠券使用
  - 訂單歷史

### 2. 管理端流程
`tests/e2e/admin/`

#### 2.1 訂單管理
- **檔案**: `orderManagement.cy.js`
- **測試內容**:
  - 訂單查看
  - 狀態更新
  - 退款處理
  - 報表查看

#### 2.2 庫存管理
- **檔案**: `inventoryManagement.cy.js`
- **測試內容**:
  - 庫存查看
  - 庫存調整
  - 警告處理
  - 進貨記錄

---

## 五、測試優先級

### 高優先級 (P1)
1. ✅ 庫存管理服務測試
2. 訂單服務測試（客戶端）
3. 用戶認證服務測試
4. 購物車狀態測試
5. 訂單 API 整合測試

### 中優先級 (P2)
1. 管理員認證服務測試
2. 促銷服務測試
3. 客戶端組件測試
4. 控制器測試
5. 認證流程整合測試

### 低優先級 (P3)
1. 模型驗證測試
2. 工具函數測試
3. 管理端組件測試
4. 中介軟體測試
5. E2E 測試

---

## 六、測試實作指引

### 測試檔案命名規則
- 服務測試: `{serviceName}.test.js`
- 組件測試: `{ComponentName}.test.vue`
- 整合測試: `{featureName}.test.js`
- E2E 測試: `{featureName}.cy.js`

### 測試資料管理
- 使用 `TestDataFactory` 生成測試資料
- 每個測試前清理資料庫狀態
- 使用 fixtures 管理複雜測試資料

### Mock 策略
- 外部 API 調用使用 MSW
- 資料庫操作使用記憶體資料庫
- 第三方服務使用 Mock

### 測試覆蓋率目標
- 服務層: 90%+
- 控制器層: 85%+
- 組件層: 80%+
- 整體專案: 85%+

---

## 七、注意事項

1. **測試隔離**: 每個測試間要完全獨立，不能有相依性
2. **資料清理**: 測試後要清理所有測試資料
3. **非同步測試**: 正確處理 async/await 和 Promise
4. **錯誤場景**: 不只測試正常流程，也要測試錯誤情況
5. **效能考量**: 測試執行時間要控制在合理範圍內